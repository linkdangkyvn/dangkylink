<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Tool V3.1 - Quick Link</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; padding-top: 30px; }
        .card { background: white; padding: 30px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 500px; }
        h2 { text-align: center; color: #2c3e50; margin-top: 0; font-weight: 800; }
        label { font-weight: bold; display: block; margin-top: 15px; color: #34495e; font-size: 14px; }
        
        .input-group { display: flex; align-items: center; gap: 8px; position: relative; }
        input { flex: 1; padding: 12px; margin-top: 5px; border: 2px solid #ecf0f1; border-radius: 8px; box-sizing: border-box; font-size: 14px; transition: 0.3s; }
        input:focus { border-color: #3498db; outline: none; }
        
        .clear-btn { background: #e74c3c; color: white; border: none; border-radius: 8px; width: 45px; height: 43px; margin-top: 5px; cursor: pointer; font-size: 18px; }
        .copy-btn { width: 100%; padding: 10px; margin-top: 10px; background: #2ecc71; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .copy-btn:hover { background: #27ae60; }

        /* N√öT QUICK LINK M·ªöI */
        .quick-btn { 
            width: 100%; padding: 12px; margin-top: 15px; 
            background: linear-gradient(135deg, #6c5ce7, #a29bfe); 
            color: white; border: none; border-radius: 8px; 
            font-weight: bold; cursor: pointer; font-size: 15px;
            display: flex; justify-content: center; align-items: center; gap: 8px;
            text-decoration: none; /* B·ªè g·∫°ch ch√¢n th·∫ª a */
            box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3);
            transition: 0.2s;
        }
        .quick-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(108, 92, 231, 0.4); }

        .result-box { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 1px dashed #bdc3c7; display: none; word-wrap: break-word; }
        .link-text { color: #d63384; font-weight: bold; font-size: 13px; margin-bottom: 5px; display: block; font-family: monospace; }
    </style>
</head>
<body>

    <div class="card">
        <h2>üõ†Ô∏è M√ÅY T·∫†O LINK V3.1</h2>
        <p style="color:#7f8c8d; font-size: 13px; text-align:center;">H·ªá th·ªëng V11 + Link4M Quick Link</p>
        
        <label>1. D√°n link g·ªëc (Drive/Fshare):</label>
        <div class="input-group">
            <input type="text" id="linkInput" placeholder="https://drive.google.com/..." oninput="taoLink()">
            <button class="clear-btn" onclick="xoaLink()">‚úñ</button>
        </div>

        <div id="ketQua" class="result-box">
            <label style="margin-top:0; color:#27ae60;">‚úÖ Link H·ªá Th·ªëng (V11):</label>
            <span id="linkOutput" class="link-text"></span>
            <button class="copy-btn" onclick="copyText()">Sao Ch√©p Link N√†y</button>

            <hr style="margin: 20px 0; border: 0; border-top: 1px dashed #b2bec3;">

            <label style="color:#6c5ce7;">üöÄ T·∫°o Link Ki·∫øm Ti·ªÅn (Link4M):</label>
            <p style="font-size: 12px; color: #636e72; margin-bottom: 5px;">B·∫•m n√∫t d∆∞·ªõi -> N√≥ s·∫Ω t·ª± m·ªü trang Link4M ƒë·ªÉ b·∫°n l·∫•y link.</p>
            
            <a id="btnQuickLink" href="#" target="_blank" class="quick-btn">
                <i class="fas fa-bolt"></i> üëâ B·∫§M ƒê·ªÇ L·∫§Y LINK KI·∫æM TI·ªÄN
            </a>
        </div>
    </div>

    <script>
        // Token l·∫•y t·ª´ ·∫£nh image_34399e.png c·ªßa b·∫°n
        const API_TOKEN = "67b810f67e172c3e986014e3"; 

        function taoLink() {
            let linkGoc = document.getElementById("linkInput").value.trim();
            if (linkGoc.length < 5) {
                document.getElementById("ketQua").style.display = "none";
                return;
            }

            // 1. T·∫°o link h·ªá th·ªëng (V11)
            let linkMaHoa = btoa(linkGoc);
            let trangChu = window.location.href.replace("admin.html", "");
            if(trangChu.endsWith("/")) trangChu = trangChu.slice(0, -1);
            let linkHeThong = trangChu + "/?id=" + linkMaHoa;

            // Hi·ªÉn th·ªã link h·ªá th·ªëng
            document.getElementById("linkOutput").innerText = linkHeThong;
            document.getElementById("ketQua").style.display = "block";

            // 2. T·∫°o Quick Link cho Link4M (D·ª±a tr√™n ·∫£nh image_34399e.png)
            // C·∫•u tr√∫c: https://link4m.co/st?api=TOKEN&url=LINK_C·∫¶N_R√öT
            let quickLink = `https://link4m.co/st?api=${API_TOKEN}&url=${encodeURIComponent(linkHeThong)}`;
            
            // G√°n v√†o n√∫t b·∫•m
            document.getElementById("btnQuickLink").href = quickLink;
        }

        function copyText() {
            let text = document.getElementById("linkOutput").innerText;
            navigator.clipboard.writeText(text);
            let btn = document.querySelector('.copy-btn');
            let oldText = btn.innerText;
            btn.innerText = "ƒê√£ Copy! ‚úÖ";
            setTimeout(() => { btn.innerText = oldText; }, 2000);
        }

        function xoaLink() {
            document.getElementById("linkInput").value = "";
            document.getElementById("ketQua").style.display = "none";
            document.getElementById("linkInput").focus();
        }
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</body>
</html>        
        /* LOADING SPINNER */
        .spinner { border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid #fff; width: 16px; height: 16px; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="card">
        <h2>üõ†Ô∏è M√ÅY T·∫†O LINK ƒêA NƒÇNG</h2>
        <p style="color:#7f8c8d; font-size: 13px; text-align:center;">H·ªá th·ªëng V11 + R√∫t g·ªçn Link4M API</p>
        
        <label>1. D√°n link g·ªëc (Drive/Fshare):</label>
        <div class="input-group">
            <input type="text" id="linkInput" placeholder="https://drive.google.com/..." oninput="taoLink()">
            <button class="clear-btn" onclick="xoaLink()">‚úñ</button>
        </div>

        <div id="ketQua" class="result-box">
            <label style="margin-top:0; color:#27ae60;">‚úÖ Link H·ªá Th·ªëng (V11):</label>
            <span id="linkOutput" class="link-text"></span>
            <button class="copy-btn" onclick="copyText('linkOutput', this)">Sao Ch√©p Link N√†y</button>

            <hr style="margin: 15px 0; border: 0; border-top: 1px solid #ddd;">

            <button class="link4m-btn" onclick="rutGonLink4M(this)">
                <div class="spinner"></div> üöÄ R√∫t g·ªçn qua Link4M ngay
            </button>
        </div>

        <div id="ketQua4M" class="result-box" style="background: #e3f2fd; border-color: #64b5f6;">
            <label style="margin-top:0; color:#0984e3;">üí∞ Link Ki·∫øm Ti·ªÅn (Link4M):</label>
            <span id="link4MOutput" class="link-text" style="color:#2980b9; font-size: 15px;"></span>
            <button class="copy-btn" style="background:#0984e3;" onclick="copyText('link4MOutput', this)">Sao Ch√©p Link4M</button>
        </div>
    </div>

    <script>
        // TOKEN C·ª¶A B·∫†N (L·∫•y t·ª´ ·∫£nh b·∫°n g·ª≠i)
        const API_TOKEN = "67b810f67e172c3e986014e3"; 

        function taoLink() {
            let linkGoc = document.getElementById("linkInput").value.trim();
            if (linkGoc.length < 5) {
                document.getElementById("ketQua").style.display = "none";
                document.getElementById("ketQua4M").style.display = "none";
                return;
            }

            // T·∫°o link h·ªá th·ªëng (V11)
            let linkMaHoa = btoa(linkGoc);
            let trangChu = window.location.href.replace("admin.html", "");
            // X√≥a d·∫•u / ·ªü cu·ªëi n·∫øu c√≥ ƒë·ªÉ tr√°nh l·ªói 2 d·∫•u //
            if(trangChu.endsWith("/")) trangChu = trangChu.slice(0, -1);
            
            let linkXong = trangChu + "/?id=" + linkMaHoa;

            document.getElementById("linkOutput").innerText = linkXong;
            document.getElementById("ketQua").style.display = "block";
            
            // ·∫®n k·∫øt qu·∫£ Link4M c≈© ƒëi khi nh·∫≠p link m·ªõi
            document.getElementById("ketQua4M").style.display = "none";
        }

        // H√ÄM G·ªåI API LINK4M
        async function rutGonLink4M(btn) {
            let linkHeThong = document.getElementById("linkOutput").innerText;
            if (!linkHeThong) return;

            // Hi·ªáu ·ª©ng Loading
            let spinner = btn.querySelector('.spinner');
            let oldText = btn.lastChild.textContent;
            spinner.style.display = 'block';
            btn.lastChild.textContent = " ƒêang k·∫øt n·ªëi Link4M...";
            btn.disabled = true;

            try {
                // G·ªçi API Link4M
                let apiUrl = `https://link4m.co/api?api=${API_TOKEN}&url=${encodeURIComponent(linkHeThong)}`;
                
                let response = await fetch(apiUrl);
                let data = await response.json();

                if (data.status === "success") {
                    document.getElementById("link4MOutput").innerText = data.shortenedUrl;
                    document.getElementById("ketQua4M").style.display = "block";
                } else {
                    alert("L·ªói Link4M: " + data.message);
                }
            } catch (error) {
                console.error(error);
                // L·ªói CORS th∆∞·ªùng g·∫∑p khi ch·∫°y tr√™n Github Pages
                alert("Kh√¥ng th·ªÉ k·∫øt n·ªëi tr·ª±c ti·∫øp ƒë·∫øn Link4M (Do ch·∫∑n CORS). B·∫°n h√£y d√πng link 'Quick Link' th·ªß c√¥ng ho·∫∑c c√†i Extension 'Allow CORS' ƒë·ªÉ fix l·ªói n√†y.");
            }

            // Tr·∫£ l·∫°i tr·∫°ng th√°i n√∫t
            spinner.style.display = 'none';
            btn.lastChild.textContent = oldText;
            btn.disabled = false;
        }

        function copyText(id, btn) {
            let text = document.getElementById(id).innerText;
            navigator.clipboard.writeText(text);
            let oldText = btn.innerText;
            btn.innerText = "ƒê√£ Copy! ‚úÖ";
            setTimeout(() => { btn.innerText = oldText; }, 2000);
        }

        function xoaLink() {
            document.getElementById("linkInput").value = "";
            document.getElementById("ketQua").style.display = "none";
            document.getElementById("ketQua4M").style.display = "none";
            document.getElementById("linkInput").focus();
        }
    </script>
</body>
</html>
