<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Link Unlocker V6</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* RESET CSS: Đảm bảo không bị vỡ giao diện trên mọi máy */
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5; 
            margin: 0; 
            padding: 20px;
            min-height: 100vh;
        }

        .container { 
            background: white; 
            width: 100%; 
            max-width: 450px; 
            margin: 0 auto; /* Căn giữa màn hình */
            padding: 25px 20px; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
            text-align: center; 
        }

        /* ẨN HIỆN CÁC BƯỚC: Dùng !important để không bao giờ bị lỗi */
        .step { display: none !important; }
        .step.active { display: block !important; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; margin-top: 10px; } to { opacity: 1; margin-top: 0; } }

        h2 { margin: 0 0 10px 0; font-size: 20px; color: #333; }
        p { color: #666; font-size: 14px; margin-bottom: 20px; line-height: 1.5; }

        /* BUTTON STYLE */
        .btn-task { 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 15px; margin-bottom: 12px; border-radius: 10px; 
            text-decoration: none; font-weight: 600; font-size: 14px; 
            color: white; width: 100%; border: none; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .btn-task:active { transform: scale(0.98); }
        
        .btn-yt { background: #ff0000; }
        .btn-zalo { background: #0068ff; }
        .btn-ads { background: linear-gradient(to right, #ff9900, #ffcc00); color: white; border-bottom: 3px solid #e68a00; }

        .btn-task.loading { background: #ccc !important; pointer-events: none; justify-content: center; }
        .btn-task.done { background: #28a745 !important; pointer-events: none; justify-content: center; }

        /* NÚT TIẾP TỤC */
        .btn-next { 
            display: block; width: 100%; padding: 15px; 
            background: #e9ecef; color: #adb5bd; 
            border-radius: 50px; border: none; font-weight: bold; 
            margin-top: 20px; pointer-events: none; 
        }
        .btn-next.unlocked { 
            background: linear-gradient(135deg, #11998e, #38ef7d); 
            color: white; pointer-events: auto; cursor: pointer;
            animation: pulse 1.5s infinite;
        }

        /* THANH TIẾN TRÌNH */
        .progress-bar { height: 5px; background: #e9ecef; margin-bottom: 20px; border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; background: #ff4757; width: 0%; transition: 0.3s; }
        
        /* BANNER */
        .ads-banner { margin: 15px 0; min-height: 50px; background: #fafafa; display: flex; align-items: center; justify-content: center; border-radius: 8px; border: 1px dashed #ddd; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-bar"><div class="progress-fill" id="myBar"></div></div>

    <div id="step1" class="step active">
        <h2>Bắt Đầu</h2>
        <p>Hệ thống đã chuẩn bị file.<br>Nhấn nút bên dưới để lấy link.</p>
        
        <a href="https://www.effectivegatecpm.com/wg1qvzvr8x?key=d28637e87066c0e12b4fae327d34c789" target="_blank" class="btn-next unlocked" onclick="setTimeout(() => { chuyenTrang(2) }, 500)">
            BẮT ĐẦU NGAY <i class="fas fa-arrow-right"></i>
        </a>
    </div>

    <div id="step2" class="step">
        <h2>Bước 1/3</h2>
        <p>Đăng ký kênh để tiếp tục</p>

        <div class="ads-banner">Quảng cáo Banner</div>

        <a href="https://www.youtube.com/channel/UC_ID_KENH_1?sub_confirmation=1" target="_blank" class="btn-task btn-yt" onclick="xuLyNhiemVu(this, 2)">
            <span><i class="fab fa-youtube"></i> Đăng Ký Kênh 1</span> <i class="fas fa-chevron-right"></i>
        </a>
        <a href="https://www.youtube.com/channel/UC_ID_KENH_2?sub_confirmation=1" target="_blank" class="btn-task btn-yt" onclick="xuLyNhiemVu(this, 2)">
            <span><i class="fab fa-youtube"></i> Đăng Ký Kênh 2</span> <i class="fas fa-chevron-right"></i>
        </a>

        <button id="btn-next-2" class="btn-next" onclick="chuyenTrang(3)" data-req="2" data-done="0">
            <i class="fas fa-lock"></i> Hoàn thành 0/2
        </button>
    </div>

    <div id="step3" class="step">
        <h2>Bước 2/3</h2>
        <p>Ủng hộ thêm kênh phụ</p>

        <a href="https://www.youtube.com/channel/UC_ID_KENH_3?sub_confirmation=1" target="_blank" class="btn-task btn-yt" onclick="xuLyNhiemVu(this, 3)">
            <span><i class="fab fa-youtube"></i> Đăng Ký Kênh 3</span> <i class="fas fa-chevron-right"></i>
        </a>
        <a href="https://www.youtube.com/channel/UC_ID_KENH_4?sub_confirmation=1" target="_blank" class="btn-task btn-yt" onclick="xuLyNhiemVu(this, 3)">
            <span><i class="fab fa-youtube"></i> Đăng Ký Kênh 4</span> <i class="fas fa-chevron-right"></i>
        </a>

        <button id="btn-next-3" class="btn-next" onclick="chuyenTrang(4)" data-req="2" data-done="0">
            <i class="fas fa-lock"></i> Hoàn thành 0/2
        </button>
    </div>

    <div id="step4" class="step">
        <h2>Bước 3/3</h2>
        <p>Bước cuối: Tham gia nhóm & Xác minh</p>

        <a href="https://zalo.me/g/LINK_NHOM_ZALO" target="_blank" class="btn-task btn-zalo" onclick="xuLyNhiemVu(this, 4)">
            <span><i class="fas fa-users"></i> Tham gia Zalo</span> <i class="fas fa-chevron-right"></i>
        </a>

        <a href="https://www.effectivegatecpm.com/wg1qvzvr8x?key=d28637e87066c0e12b4fae327d34c789" target="_blank" class="btn-task btn-ads" onclick="xuLyQuangCao(this, 4)">
            <span><i class="fas fa-star"></i> Link Tài Trợ (Click)</span> <i class="fas fa-external-link-alt"></i>
        </a>

        <button id="btn-next-4" class="btn-next" onclick="chuyenTrang(5)" data-req="2" data-done="0">
            <i class="fas fa-lock"></i> Hoàn thành 0/2
        </button>
    </div>

    <div id="step5" class="step">
        <h2 style="color: #28a745;">Thành Công!</h2>
        <p>Link tải của bạn ở bên dưới.</p>
        <a href="#" id="finalLink" class="btn-next unlocked">
            <i class="fas fa-download"></i> TẢI FILE NGAY
        </a>
    </div>

</div>

<script src="https://pl28509723.effectivegatecpm.com/50/5f/53/505f5395f6cbf8e7c711f97b861a4233.js"></script>
<script src="https://pl28509728.effectivegatecpm.com/af/4e/58/af4e58f14a43905474b0082289e54c49.js"></script>

<script>
    // === 1. LOGIC ANTI-RELOAD BẰNG URL HASH ===
    function khoiPhuc() {
        // Kiểm tra xem trên link có #step2, #step3 không
        let hash = window.location.hash; 
        if (hash && hash.includes('step')) {
            let stepNum = hash.replace('#step', '');
            chuyenTrang(stepNum, false); // false để ko bị lặp lại
        }
    }

    // === 2. HÀM CHUYỂN TRANG ===
    function chuyenTrang(n, updateHistory = true) {
        // Ẩn hết các bước
        document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        // Hiện bước cần đến
        let target = document.getElementById('step' + n);
        if(target) target.classList.add('active');

        // Cập nhật thanh tiến trình
        document.getElementById('myBar').style.width = ((n-1)*25) + "%";

        // Lưu vào lịch sử URL (thêm #step2 vào link)
        if (updateHistory) {
            window.location.hash = "step" + n;
        }
    }

    // === 3. XỬ LÝ NHIỆM VỤ THƯỜNG ===
    function xuLyNhiemVu(el, step) {
        if(el.classList.contains('done')) return;
        el.classList.add('loading');
        el.querySelector('span').innerText = "Đang kiểm tra...";
        
        setTimeout(() => {
            el.classList.remove('loading');
            el.classList.add('done');
            el.innerHTML = '<i class="fas fa-check"></i> Đã hoàn thành';
            checkNext(step);
        }, 2000);
    }

    // === 4. XỬ LÝ QUẢNG CÁO 5 GIÂY ===
    function xuLyQuangCao(el, step) {
        if(el.classList.contains('done')) return;
        el.classList.add('loading');
        
        let count = 5;
        el.querySelector('span').innerText = `Vui lòng chờ ${count}s...`;
        
        let timer = setInterval(() => {
            count--;
            el.querySelector('span').innerText = `Vui lòng chờ ${count}s...`;
            if (count <= 0) {
                clearInterval(timer);
                el.classList.remove('loading');
                el.classList.add('done');
                el.innerHTML = '<i class="fas fa-check"></i> Đã hoàn thành';
                checkNext(step);
            }
        }, 1000);
    }

    // === 5. KIỂM TRA MỞ KHÓA ===
    function checkNext(step) {
        let btn = document.getElementById('btn-next-' + step);
        let req = parseInt(btn.dataset.req);
        let done = parseInt(btn.dataset.done) + 1;
        btn.dataset.done = done;
        btn.innerHTML = `<i class="fas fa-lock"></i> Hoàn thành ${done}/${req}`;

        if(done >= req) {
            btn.classList.add('unlocked');
            btn.innerHTML = 'TIẾP TỤC <i class="fas fa-arrow-right"></i>';
        }
    }

    // === 6. KHỞI CHẠY ===
    // Lấy link đích
    const params = new URLSearchParams(window.location.search);
    let finalUrl = "https://google.com";
    if (params.get('link')) finalUrl = params.get('link');
    if (params.get('id')) { try { finalUrl = atob(params.get('id')); } catch(e){} }
    document.getElementById('finalLink').href = finalUrl;

    // Chạy khôi phục trang
    khoiPhuc();
</script>

</body>
</html>
